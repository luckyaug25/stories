<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Stories</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="index.css">
  <link rel="icon" type="image/x-icon" href="Logo.png">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: #0a0a0a; /* black background */
      color: white;
    }
    .story-item {
      background-color: #000; /* black story container */
      border: 2px solid #222; /* subtle dark border */
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    .story-item a, .story-item button {
      border: 2px solid transparent;
    }
    .story-item a {
      background-color: #007bff; /* blue */
      color: white;
    }
    .story-item button {
      background-color: #00a65a; /* green */
      color: white;
    }
    /* Remove hover & border-radius globally */
    button, a {
      border-radius: 0 !important;
      transition: none !important;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-4 sm:p-6 lg:p-8">

  <div class="max-w-4xl w-full bg-black p-6 border-2 border-gray-800 shadow-2xl">
    <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-8 text-center leading-tight">
      Manage Your Stories
    </h1>

    <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-6 mb-10">
      <a href="/" class="w-full sm:w-auto">
        <button class="w-full bg-blue-700 text-white font-bold py-3 px-8 border-2 border-blue-600">
          Home
        </button>
      </a>
      <a href="/write" class="w-full sm:w-auto">
        <button class="w-full bg-green-700 text-white font-bold py-3 px-8 border-2 border-green-600">
          Write Story
        </button>
      </a>
    </div>

    <div id="storiesList" class="space-y-6">
        <p class="text-center text-gray-400 text-lg" id="loading-message">Loading stories...</p>
    </div>
  </div>

  <div id="custom-message-box" class="fixed top-4 right-4 p-4 text-white text-lg font-semibold shadow-lg z-[100] transition-transform duration-300 transform translate-x-full hidden"></div>

  <script>
    function showCustomMessage(message, type = "info") {
        const messageBox = document.getElementById('custom-message-box');
        if (!messageBox) return;
        messageBox.textContent = message;
        messageBox.className = `fixed top-4 right-4 p-4 text-white text-lg font-semibold shadow-lg z-[100] transition-transform duration-300 transform translate-x-0`;
        if (type === "error") messageBox.classList.add('bg-red-600');
        else if (type === "success") messageBox.classList.add('bg-green-600');
        else messageBox.classList.add('bg-blue-600');
        messageBox.classList.remove('hidden');
        setTimeout(() => {
            messageBox.classList.add('translate-x-full');
            messageBox.addEventListener('transitionend', () => {
                messageBox.classList.add('hidden');
            }, { once: true });
        }, 3000);
    }

    async function fetchStories() {
      const storiesList = document.getElementById('storiesList');
      const loadingMessage = document.getElementById('loading-message');

      try {
        if (loadingMessage) loadingMessage.style.display = 'block';
        const response = await fetch('/api/stories');
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const stories = await response.json();
        loadingMessage.style.display = 'none';

        storiesList.innerHTML = '';

        if (stories.length === 0) {
            storiesList.innerHTML = '<p class="text-center text-gray-500 text-lg">No stories to manage yet. Start writing one!</p>';
        } else {
            stories.forEach(story => {
              const storyElement = document.createElement('div');
              storyElement.classList.add('story-item', 'p-6', 'flex', 'justify-between', 'items-center');
              storyElement.innerHTML = `
                <h3 class="text-2xl font-semibold text-white mb-0">${story.title}</h3>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                  <a href="edit-story.html?id=${story.id}" class="inline-block py-2 px-6 font-bold">Edit</a>
                  <button onclick="deleteStory(${story.id})" class="py-2 px-6 font-bold">Delete</button>
                </div>
              `;
              storiesList.appendChild(storyElement);
            });
        }
      } catch (err) {
        console.error("Error fetching stories:", err);
        storiesList.innerHTML = '<p class="text-center text-red-400 text-lg">Failed to load stories. Please try again later.</p>';
        showCustomMessage("Failed to load stories. Please try again later.", "error");
      }
    }

    document.addEventListener('DOMContentLoaded', fetchStories);

    async function deleteStory(storyId) {
      if (!confirm("Are you sure you want to delete this story?")) return;
      try {
        const response = await fetch(`/api/stories/${storyId}`, { method: 'DELETE' });
        if (response.ok) {
          showCustomMessage("Story deleted successfully!", "success");
          fetchStories();
        } else {
          showCustomMessage("Failed to delete the story.", "error");
        }
      } catch (err) {
        console.error("Error deleting story:", err);
        showCustomMessage("Error deleting story.", "error");
      }
    }

    window.confirm = function(message) {
        return prompt(message + "\n\nType 'yes' to confirm or anything else to cancel.") === 'yes';
    };
  </script>
</body>
</html>
